### 网络应用的体系架构

可能的应用架构：

-   客户端-服务器 (C/S: client/server)
-   对等模式 (P2P: Peer to Peer)
-   混合体：客户端-服务器和对等体系架构



#### C/S 体系架构

**服务器**：

-   先启动，一直运行，等待被访问
-   固定的IP地址和约定的端口号
-   可扩展性差（客户端增加到一定数量时服务器性能出现断崖式下跌），可靠性差（一旦服务器宕机，所有客户端将无法访问应用）

**客户端**：

-   后启动，主动与服务器通信
-   与互联网间歇性的连接
-   可能是动态IP地址
-   不直接与其它客户端通信



### P2P体系架构

-   几乎没有一直运行的服务器
-   任意端系统之间都可以通信，每一个节点既是客户端又是服务器
-   自扩展性：新peer节点带来新的服务请求，也带来新的服务能力
-   参与的主机间歇性连接且可以改变IP地址
-   举例：迅雷



## 应用层原理

#### 进程通信

-   进程：在主机上运行的应用程序
-   在同一个主机内，使用进程间通信机制通信
-   不同主机（借助传输层提供的服务）通过交换报文来通信
-   服务器进程：等待连接的进程
-   客户端进程：发起通信的进程



#### 分布式进程通信需要解决的问题

**问题1**：进程标识和寻址问题（服务用户）

-   进程为了接收报文，必须有一个标识，即SAP
    -   主机：唯一的32位IP地址
    -   所采用的传输层协议：TCP or UDP
    -   端口号（举例：HTTP：TCP 80；Mail: TCP 25；FTP：TCP 2）
-   每个进程用IP+port标识端节点
-   本质上一对主机进程之间的通信由2个端节点构成

**问题2**：传输层如何为应用层提供服务？（怎样服务）

1.  位置：层间界面的SAP（TCP/IP：Socket）
2.  形式：应用程序接口API （TCP/IP：Socket API）
3.  层间接口必须要携带的信息
    -   要传输的报文（对于本层来说：SDU）
    -   谁传的：自己的应用进程的标识：IP + TCP(UDP) 端口
    -   传给谁：对方的应用进程的标识：对方的IP + TCP(UDP)端口

**问题3**：如何使用传输层提供的服务，实现应用进程之间的报文交换，实现应用（用户使用服务）

1.  定义应用层协议：报文格式，解释和时序等等
2.  编制程序，使用OS提供的API，调用网络基础设施提供通信服务传报文，实现应用时序等等



TCP socket：

-   用一个整数表示两个应用实体之间的通信关系（本地标识），使穿过层间接口的信息量最小。

-   4元组：（源IP，源端口号，目标IP，目标端口号）



UDP Socket:

-   由于两个进程之间的通信无需建立连接（每个报文都是独立传输的；前后报文可能分发给不同的分布式进程），因此只能用一个整数表示本应用实体的标识
-   2元组：本机IP，本机端口
-   但是在传输报文时，需要提供对方IP和端口；接收报文时，传输层需要上传方的IP和端口



#### 应用需要传输层提供什么样的服务？

-   数据丢失率（可靠性）
-   延迟
-   吞吐量
-   安全性（SSL在应用层：https）